<?php
include('connProd.php') ;
$username = "dps";
$password = "dps123";
$hostname = "172.16.1.4";  
// $dbhandle = mysqli_connect($hostname, $username, $password) ;
// $selected = mysqli_select_db($dbhandle,'dubai') ;
// if($dbhandle->connect_errno > 0){
//   die('Unable to connect to database' . $dbhandle->connect_error);
// }
// $trackers = "select * from imei_st3";
// $trackers_result = mysqli_query($dbhandle, $trackers);
// while ($trackersRow = mysqli_fetch_assoc($trackers_result))
//   {
//     $trackersData[]=$trackersRow;
//   }
$trackersData[]=array("863940059807720-ST1660570228395", "864593056335648-ST1674127529057", "867730058826078-ST1673615228062", "863940058237515-ST1648107823536", "864593056289936-ST1676273960402", "864200050747634-ST1656405516559", "860186050615109-ST1673530978388", "864593056351769-ST1675422197138", "863069057972219-ST1671606047292", "863940058326870-ST1656578025332", "864593056286007-ST1661601775545", "863069058741134-ST1671000760665", "867730058927400-ST1672301214124", "863940059847445-ST1660570147851", "863940059849276-ST1675767149393", "860186050155551-ST1665065493968", "863069058679052-ST1652250942949", "860186050566260-ST1639575480427", "863940059900673-ST1660568138996", "863940059823412-ST1668166688361", "864200050828848-ST1664199512283", "863069058011512-ST1671000672212", "864200050888719-ST1675700256535", "863940058243679-ST1668694233371", "860186051841696-ST1666679636513", "864593056285405-ST1669283961101", "863940059811409-ST1660570183441", "863069058722928-ST1671273634302", "863940058365845-ST1675072920665", "864475048385974-ST1658125297205", "864593056271272-ST1660817247603", "863069057941354-ST1667998792449", "864593056410847-ST1660569182489", "863940058639587-ST1640090714000", "864593056471625-ST1660570323692", "867730056557394-ST1654518100755", "863940059720972-ST1676294957948", "864593056411399-ST1660570649678", "863940059867328-ST1673519243119", "863069057419708-ST1665559329152", "863069058724080-ST1668687359105", "864593056435471-ST1673519337737", "864200050711325-ST1664176268032", "863940059774342-ST1660570992232", "867730056573649-ST1629033513774", "860186050533070-ST1666700273418", "864593056495459-ST1660817337305", "863069057403504-ST1667816068046", "864593056338626-ST1663415342834", "864593056325524-ST1675767635518", "867730058799550-ST1656501490647", "863940059710783-ST1661601447590", "860186050527197-ST1675072851660", "860186051786701-ST1667305038099", "860186050536883-ST1665409536091", "864593056372757-ST1660640778477", "867730058944100-ST1530355013000", "867730056556180-ST1658750877999", "864593056231052-ST1675422256763", "864593056343535-ST1647409956900", "860186050524707-ST1669795970117", "863940059850902-ST1660570596693", "866770056747687-ST1664451499046", "860186050544432-ST1673009242472", "860640057751903-ST1659526675474", "863069058047847-ST1666186829401", "863069058747545-ST1652357520614", "867730058841170-ST1662967926581", "867730058817550-ST1660295459769", "867604053522489-ST1667305075733", "864593056227308-ST1661601712904", "864593056451544-ST1662701132474", "863940059766801-ST1660567806601", "863940058198394-ST1652084189229", "864593056253429-ST1675422217073", "867730058926800-ST1656504159735", "867730058837150-ST1672227397239", "860186050170881-ST1666511818136", "863940059820509-ST1675072804414", "863069057971666-ST1665144909296", "860186051848220-ST1666679604321", "863940058263487-ST1646902955148", "864593056303299-ST1672221520058", "867730058806750-ST1668513110758", "863940059767866-ST1676294984693", "864593056367369-ST1647871958319", "863940058330799-ST1671000585146", "863940059802101-ST1675767694825", "867730058853170-ST1655369705433", "864593056483539-ST1668687387261", "864200050767889-ST1675700256535", "863940059886682-ST1675072784226", "864593056428153-ST1660569346147", "864475048385412-ST1629031633858", "864593056410607-ST1660569043032", "867730058836192-ST1658238062156", "864593056436008-ST1660571033166", "864593056431561-ST1675767384633", "864593056427908-ST1660569384050", "867730058887700-ST1668513110758", "863069057924285-ST1670917798767", "863940058397137-ST1662701266116", "867730058856770-ST1655369941008", "863069057997729-ST1670917763231", "860186050107875-ST1633523200305", "864593056268435-ST1661864408682", "864593056265522-ST1656405447761", "864593056325086-ST1673347756246", "864593056293698-ST1670236883618", "864593056329567-ST1670238267294", "867604056942734-ST1659526720911", "863940059847627-ST1674196485033", "867730058836044-ST1658480043829", "863940059771033-ST1662096315681", "864593056310427-ST1661498091738", "864593056463100-ST1650882160132", "863940059852452-ST1662644573508", "864593056336885-ST1661513830974", "864593056336422-ST1674655985045", "860186050139050-ST1666769619471", "864475048389091-ST1657100685411", "864593056442824-ST1663656038548", "867730058852777-ST1671004478688", "867730058902580-ST1658753025019", "863940058227854-ST1652444404787", "864593056293748-ST1674633548757", "867730056563483-ST1668513110758", "864593056437121-ST1660571087121", "867730058836291-ST1673011073878", "863069058043739-ST1668692368082", "863940059847643-ST1660567755189", "863940059737653-ST1660570030607", "863940058244222-ST1663392348397", "356173062261123-ST1654007864075", "864200050778803-ST1663659071162", "863940058399976-ST1670237170304", "867730058943600-ST1668513110758", "863940059763279-ST1673011448473", "867730056630415-ST1658750798807", "863940059896772-ST1668692333435", "864593056311169-ST1661599810380", "863069058001117-ST1670500428593", "863940059869944-ST1660804771274", "867730058868070-ST1651236119385", "867730058906763-ST1656659938819", "863069057399009-ST1661501191633", "863940059894397-ST1669124209982", "864475048385941-ST1660913056491", "863940059814460-ST1657691473485", "867730058910922-ST1673355175794", "867730058818750-ST1660295376153", "863069057394638-ST1673614921853", "867730058942500-ST1656059053079", "864593056350886-ST1660570390272", "867730058877300-ST1655370024274", "863069057970270-ST1667815951487", "863940059812324-ST1672294010414", "867730058928000-ST1656577054564", "863940059727597-ST1670238217562");
//for ($b=0;$b<=1;$b++){
for ($b=0;$b<=count($trackersData[0]);$b++){
    $result  = $session->execute("SELECT * FROM trackers_by_imei where imei ='".$trackersData[0][$b]."' ");
    foreach ($result as $row) {
        $imei= $row['imei'];
        $tid= $row['trackerid'];
        $org= $row['orgid'];
        $st=explode("-",$imei);
        //print_r($st[1]);
        $simserial=$row["sim_serial"]."-".$st[1];
        $simnumber=$row["sim_number"]."-".$st[1];
        $result_imei= $session->execute("update trackers_by_imei set sim_serial='".$simserial."' , sim_number='".$simnumber."' where (imei='".$row["imei"]."')");
        $result_tid= $session->execute("update trackers_by_trackerid set sim_serial='".$simserial."' , sim_number='".$simnumber."' where (trackerid =".$row["trackerid"]." );");
        foreach ($row['userid'] as $followed) {
            echo "imei - ".$imei." trackerid - ". $tid . " org - " . $org." userid - ". $followed . " simserial - ".$simserial."<br><br>";
            $result_tid= $session->execute("update trackers_by_userid set sim_serial ='".$simserial."', sim_number='".$simnumber."' where (orgid =".$org.") and (userid =".$followed.") and (trackerid=".$tid.")");
        }
    }
}
//print_r($st)
//UPDATE "earthone"."trackers_by_userid" SET "sim_number" = '971564076295-ST1671015399455' WHERE ("orgid" = e99f7860-35e7-11e8-8562-3fa9eb090547) AND ("trackerid" = fb0de730-35e7-11e8-b7c2-d5d197cd5ddc) AND ("userid" = ea0b0b70-35e7-11e8-8db2-0c33bef12861);

?>