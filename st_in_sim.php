<?php
include('connProd.php') ;
$username = "dps";
$password = "dps123";
$hostname = "172.16.1.4";  
// $dbhandle = mysqli_connect($hostname, $username, $password) ;
// $selected = mysqli_select_db($dbhandle,'dubai') ;
// if($dbhandle->connect_errno > 0){
//   die('Unable to connect to database' . $dbhandle->connect_error);
// }
// $trackers = "select * from imei_st3";
// $trackers_result = mysqli_query($dbhandle, $trackers);
// while ($trackersRow = mysqli_fetch_assoc($trackers_result))
//   {
//     $trackersData[]=$trackersRow;
//   }
$trackersData[]=array("869633108433942-ST1663772874160", "866907077306155-ST1668684148274", "860186050052345-ST1676286824927", "866907050485896-ST1675946586557", "860640057774426-ST1662538666809", "860640057740245-ST1662538751849", "866907050770392-ST1657879341580", "860186050022900-ST1649325291315", "860186051768626-ST1657175655478", "867730056630159-ST1663254820909", "860186051845309-ST1644837106459", "863595308708021-ST1675407868783", "866907057608225-ST1661507225059", "867604055790472-ST1660051088260", "868963047133814-ST1656057092901", "860186056654097-ST1653310697000", "866907058133520-ST1672827218362", "867730056628989-ST1657217470540", "860536045330778-ST1676357521669", "867604055772082-ST1645770819880", "860186051817050-ST1675691844924", "867604055787254-ST1675190982512", "866770056720452-ST1662538531296", "860186051801948-ST1674822812516", "863940058773360-ST1660647370089", "866907050837707-ST1676033907575", "866907050776560-ST1673426368795", "866907077305857-ST1668684167248", "866907053369467-ST1659427014609", "864351052027903-ST1660568918171", "868963043479708-ST1667920099541", "863257067900078-ST1676116224852", "867604055794326-ST1658755526088", "863069057448889-ST1673867411092", "866480083981284-ST1675252417462", "867604055812052-ST1658755714420", "867730058790928-ST1661518245451", "860186051772792-ST1672143363242", "867730058790209-ST1660749895986", "867730056567807-ST1636969514593", "866907057500869-ST1629715101000", "860186050056569-ST1663322300454", "867604055721808-ST1660051088260", "867730058827167-ST1662987885788", "860186051877526-ST1674566486051", "866907056735797-ST1658489039746", "866907057548602-ST1676355519074", "860186050066931-ST1675691771078", "860186051814131-ST1662538914177", "866770056761928-ST1662538549944", "867730058934583-ST1660832593413", "860186051777213-ST1674568810131", "866907050838275-ST1657879341580", "860186051802458-ST1675248473997", "860186050097944-ST1672142762340", "869632105725359-ST1676312010875", "867604077781240-ST1676011254648", "866907050779397-ST1676116224852", "866907057698588-ST1676355519074", "867730056557485-ST1659019686468", "860186051670996-ST1669622282522", "869632105675138-ST1662987991025", "860186050002766-ST1670664193326", "860186050026554-ST1667919744192", "860186051828412-ST1665476267116", "864017117949943-ST1676312010875", "860517041814437-ST1676011334467", "867737776544608-ST1658486725039", "867730056565454-ST1660646918386", "860186050028725-ST1667919698102", "867730057777324-ST1638095927666", "867707778917418-ST1673006682993", "866907051370111-ST1653029780736", "860186050067543-ST1675946586557", "866907059514835-ST1674124171759", "867604055787635-ST1671789263399", "860186051663306-ST1664891241070", "860640057729263-ST1662538735279", "866907053375316-ST1675249468999", "864017113958978-ST1675946586557", "863257067857922-ST1672132931076", "860186051864300-ST1672117502474", "866907077303863-ST1676294570182", "866907057620048-ST1666699361005", "860186050026364-ST1655472289220", "867604055811807-ST1636894856506", "867604055791348-ST1658755600620", "866907050838629-ST1674629343160", "860640057279731-ST1658755566638", "860186051747414-ST1674822792779", "867604058795890-ST1672142975949", "860186050040878-ST1664718741541", "866907057684507-ST1675252417462", "866770056719710-ST1664959406286", "867730058952742-ST1668430949608", "863596331010454-ST1676011254648", "867730053300988-ST1665648776296", "866907004190185-ST1674714218402", "860517041812738-ST1676011920748", "866907056800807-ST1676286824927", "860186051803886-ST1663054536615", "863584000839156-ST1676293743522", "860186051762827-ST1675691863907", "867604055775614-ST1660051088260", "866907057461963-ST1664369245924", "863520940569936-ST1671809647708", "860186051816037-ST1675691988238", "860186050081955-ST1676286824927", "867730058968441-ST1662375197015", "867730056568664-ST1669115314303", "864475040009697-ST1661424476537", "867730058923933-ST1666677860948", "866770056736649-ST1664959429562", "866907077309009-ST1670319742069", "867604055772793-ST1660051088260", "860186050009345-ST1676111628144", "860640050750167-ST1656056921718", "863257067900185-ST1676293807751", "860186050092267-ST1667919989118", "860186050040951-ST1653053750304", "866770056806038-ST1672142864063", "860536045328020-ST1656057057848", "863540060192730-ST1675864663584", "866907050784254-ST1675946586557", "866907077303962-ST1670659749355", "860186050140595-ST1672142719851", "864200050724096-ST1661424476537", "860186050004946-ST1670664299250", "860186050112834-ST1668502770309", "860186050079666-ST1675192584192", "860186051866990-ST1675691731252", "868963043314749-ST1660051088260", "867730058929633-ST1675236918909", "860186050123252-ST1635226384718", "867604055811351-ST1633000585935", "860186051852818-ST1675691710660", "867604058792996-ST1662538480604", "860186050171186-ST1649325242088", "867730058786582-ST1673449987810", "867730058928650-ST1674135164488", "863940058174353-ST1652273433915", "867730077568664-ST1675252417462", "866907050835878-ST1676033937576", "860186050168984-ST1664959476175", "860186051647846-ST1675691751526", "864200050830521-ST1663861287280", "866480087898171-ST1664446340607", "860186050147749-ST1676286824927", "867604055794441-ST1658755698419", "860186050158704-ST1667920019457", "863940058783864-ST1675248882884", "868963043500867-ST1659103560671", "867604053492402-ST1660051088260", "867604055721675-ST1660051088260", "860640050743030-ST1658755454994", "867730058907777-ST1657208107073", "863520940809930-ST1671789263399", "860186050028915-ST1669622182758", "866907050772724-ST1675189094560", "863940058317143-ST1676355519074", "867730058925268-ST1661344902354", "860186051866156-ST1675919320655", "866907077302792-ST1660562209000", "864200050080024-ST1676011920748", "867737776687282-ST1664973863524", "863520930826228-ST1676016407324", "864017114025152-ST1674714176649", "860186051885776-ST1661344902354", "866907056648180-ST1676286824927", "866907050811669-ST1675249468999", "866907051369386-ST1668404593351", "860186050030424-ST1676286824927", "868963040962839-ST1667996686279", "866907056752594-ST1664462384874", "860186050149463-ST1661518245451", "867604055787239-ST1662538601536", "866855033054235-ST1659334078722", "866907077739865-ST1670663887474", "860186050093628-ST1672907029708", "869633106921596-ST1669034405408", "866907081540786-ST1673260543513", "866907050835961-ST1676119856867", "866093081034845-ST1676355519074", "869350940889928-ST1671809676607", "866907050774288-ST1667812114961", "867604055811617-ST1662538686632", "867730058793039-ST1663844990423", "860186050013255-ST1661344902354", "867604055790431-ST1639465104774", "860186050141205-ST1670561830318", "863940058760672-ST1660719108709", "860517041869639-ST1664606392738", "866907050787646-ST1668696239981", "867730058792221-ST1661424476537", "860536049291539-ST1662375301126", "860186051687487-ST1675249468999", "867730058928650-ST1660646918386", "869632107256643-ST1676312010875", "867604055797220-ST1658755665893", "867730056632312-ST1640874659164", "860186050171152-ST1676355519074", "866907050838902-ST1675348816507", "866907057681586-ST1667997669244", "866907050774902-ST1664437402032", "866907058535476-ST1665313790882", "860186050025580-ST1672142778817", "860186050094099-ST1675692005202", "860186051846844-ST1654675222813", "866770056697379-ST1672142846129", "866907050776006-ST1657879341580", "864475048387855-ST1666677860948", "867730058924006-ST1642149979967", "869633104187492-ST1668145818090", "867730058968466-ST1624191236372", "860186050026067-ST1675506650299", "867730058924777-ST1657208049570", "867730058923966-ST1676286824927", "867604053492253-ST1662538717425", "860640057774350-ST1660051088260", "866907059235514-ST1673274380475", "860186050091145-ST1672142741949", "866907050392610-ST1662539438403", "866907050832022-ST1676019995646", "866907057686419-ST1669293490223", "860640057305338-ST1640075088093", "867604055812417-ST1675331944999", "863596321078464-ST1675407868783", "867604055771332-ST1664959363161", "863540061128261-ST1676356012070", "860186050154158-ST1667919765104", "869632107105365-ST1676312010875", "866770056697353-ST1672142828446", "867604055783808-ST1660051088260", "867730058898754-ST1654522501203", "860186050021092-ST1674043491797", "866907056769556-ST1668433090988", "866907056647190-ST1675357248710", "860640057171664-ST1675761743939", "867604055801451-ST1660051088260", "867730058790274-ST1662796695713", "866907050777740-ST1675189209834", "869632105345256-ST1676311784833", "867730056568367-ST1656512275858", "863540811126142-ST1675933485756", "860640057267009-ST1636011021441", "860186051805741-ST1675691787241", "867604055804430-ST1656057207253", "863069057448442-ST1674197568134", "860186077735649-ST1675249468999", "866907050774981-ST1664437402032", "867604055787494-ST1675252640586", "867604058803827-ST1672142663413", "860186051851000-ST1675691650973", "866907059308675-ST1671727714243", "867730058791033-ST1666793187480", "860640050743501-ST1657103516306", "867604055721949-ST1658755770492", "860186051766455-ST1653053750304", "862093081130464-ST1665148168439", "860186050171152-ST1646042217530", "866093081027327-ST1664441585833", "866770056709661-ST1661344946969", "867730058904537-ST1667655284459", "860186051667281-ST1672143347875", "866907050834167-ST1675348735470", "867730056701018-ST1675761743939", "860186050155452-ST1672142794025");

//for ($b=0;$b<=1;$b++){
for ($b=0;$b<=count($trackersData[0]);$b++){
    $result  = $session->execute("SELECT * FROM trackers_by_imei where imei ='".$trackersData[0][$b]."' ");
    foreach ($result as $row) {
        $imei= $row['imei'];
        $tid= $row['trackerid'];
        $org= $row['orgid'];
        $st=explode("-",$imei);
        //print_r($st[1]);
        $simserial=$row["sim_serial"]."-".$st[1];
        $simnumber=$row["sim_number"]."-".$st[1];
        $result_imei= $session->execute("update trackers_by_imei set sim_serial='".$simserial."' , sim_number='".$simnumber."' where (imei='".$row["imei"]."')");
        $result_tid= $session->execute("update trackers_by_trackerid set sim_serial='".$simserial."' , sim_number='".$simnumber."' where (trackerid =".$row["trackerid"]." );");
        foreach ($row['userid'] as $followed) {
            echo "imei - ".$imei." trackerid - ". $tid . " org - " . $org." userid - ". $followed . " simserial - ".$simserial."<br><br>";
            $result_tid= $session->execute("update trackers_by_userid set sim_serial ='".$simserial."', sim_number='".$simnumber."' where (orgid =".$org.") and (userid =".$followed.") and (trackerid=".$tid.")");
        }
    }
}
//print_r($st)
//UPDATE "earthone"."trackers_by_userid" SET "sim_number" = '971564076295-ST1671015399455' WHERE ("orgid" = e99f7860-35e7-11e8-8562-3fa9eb090547) AND ("trackerid" = fb0de730-35e7-11e8-b7c2-d5d197cd5ddc) AND ("userid" = ea0b0b70-35e7-11e8-8db2-0c33bef12861);

?>